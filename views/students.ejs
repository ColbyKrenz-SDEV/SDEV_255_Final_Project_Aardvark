<html lang="en">
<%- include("./partials/head.ejs") %>

<body>
    <%- include("./partials/navbar.ejs") %>  

  <main class="content">

    <section id="sign-up">
      <div class="section-inner">
        <h1>Modify Your Schedule</h1>
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Pariatur voluptatum maxime beatae qui quod. Amet minus accusantium nesciunt provident, sint tempore ratione aliquam sed harum labore possimus sit laudantium nisi. Lorem ipsum dolor sit amet consectetur adipisicing elit. Est accusantium sint praesentium numquam inventore et autem corporis reprehenderit accusamus necessitatibus nisi dicta non, perferendis rem fugit animi distinctio, aspernatur nesciunt?</p>
      </div>
    </section>

    <section id="signup-btn">
      <div class="section-inner">
        <button type="button" class="block" onclick="hideFunction()">Add/Drop Classes</button> 
      </div>
    </section>  

    <section id="hidden" style="display:none">
      <div id="hide-div">
        <h2>Add or Drop Courses</h2>
        <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Veniam repudiandae laborum corporis eaque 
          necessitatibus eum, perferendis at distinctio laudantium delectus tenetur, quas eius sint deleniti 
          reprehenderit culpa repellendus! Totam, ratione. Lorem ipsum dolor, sit amet consectetur adipisicing 
          elit. Dolore nisi cupiditate reiciendis eligendi ipsum corrupti id, asperiores ipsam laboriosam quis 
          expedita nobis sed alias, nihil enim provident sit ut nemo?</p>
      
          <div class="hide-select">
            <div class="row">
              <div class="label-col">
              <label for="add-drop-select">Select a Course:</label>
              </div>
              <div class="input-col">
                <select id="add-drop-select">
                  <% if (courses.length > 0) { %>
                    <% courses.forEach(course => { %>
                      <option value="<%= course._id %>"><%= course.cname %></option>                                
                    <% }) %>
                  <% } else { %>
                    <p>There are no courses to select.</p>                              
                  <% } %>
                </select>
              </div>
            </div>
            <br>
            <div class="row">
              <input type="button" class="drop" value="Drop Class" id="drop-button" data-doc="<%= user._id %>">
              <input type="button" class="add" value="Add Class " id="add-button" data-doc="<%= user._id %>">
            </div>
          </div>
      </div>
    </section>
    
  </main>
  <%- include("./partials/footer.ejs") %>

  <script>
    const addButton = document.querySelector('input.add');
    const dropButton = document.querySelector('input.drop');
    const courseSelect = document.getElementById('add-drop-select');
    let courseId; 
    courseId = GetSelectedOption(courseSelect);

    // Add event listener for selection changes
    courseSelect.addEventListener('change', (e) => {
      GetSelectedOption(courseSelect);
    });

    // Add class to student's schedule
    addButton.addEventListener('click', async (e) => {
      const userId = addButton.dataset.doc;
      try {
        const res = await fetch('/students', {
          method: 'POST',
          body: JSON.stringify({ userId, courseId }),
          headers: { 'Content-Type': 'application/json' }
        });        
      } 
      catch (err) {
        console.log(err);
      } 
    });

    // Drop class from a student's schedule


    // Function to hide the add/drop section
    function hideFunction() {
      var x = document.getElementById("hidden"),
      displayValue = "";
      if (x.style.display == "")
      displayValue = "none";

      x.style.display = displayValue;
    }

    // Determine the id for the currently selected course
    function GetSelectedOption(courseSelect) {
      let options = courseSelect.getElementsByTagName('option');
      selectedCoureseId = options[courseSelect.selectedIndex].value;
      return selectedCoureseId;
    }
  </script>
</body>

</html>